#include <assert.h>
#include <ctype.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "clm_string.h"

/*****************************************************************************************
 * STATICS AND CONSTANTS BEGIN
 ****************************************************************************************/

/** Look-up table for fast 'to_lower' method */
u8 static const CLM_STRING_LOWER_LUT[] = {
    [' '] = ' ',   ['!'] = '!',   ['\"'] = '\"', ['#'] = '#', ['$'] = '$', ['%'] = '%',
    ['&'] = '&',   ['\''] = '\'', ['*'] = '*',   ['+'] = '+', [','] = ',', ['-'] = '-',
    ['='] = '=',   ['`'] = '`',   ['^'] = '^',   ['~'] = '~', ['.'] = '.', ['/'] = '/',
    ['\\'] = '\\', ['|'] = '|',   [':'] = ':',   [';'] = ';', ['('] = '(', [')'] = ')',
    ['{'] = '{',   ['}'] = '}',   ['<'] = '<',   ['>'] = '>', ['['] = '[', [']'] = ']',
    ['_'] = '_',   ['0'] = '0',   ['1'] = '1',   ['2'] = '2', ['3'] = '3', ['4'] = '4',
    ['5'] = '5',   ['6'] = '6',   ['7'] = '7',   ['8'] = '8', ['9'] = '9', ['a'] = 'a',
    ['A'] = 'a',   ['b'] = 'b',   ['B'] = 'b',   ['c'] = 'c', ['C'] = 'c', ['d'] = 'd',
    ['D'] = 'd',   ['e'] = 'e',   ['E'] = 'e',   ['f'] = 'f', ['F'] = 'f', ['g'] = 'g',
    ['G'] = 'g',   ['h'] = 'h',   ['H'] = 'h',   ['i'] = 'i', ['I'] = 'i', ['j'] = 'j',
    ['J'] = 'j',   ['k'] = 'k',   ['K'] = 'k',   ['l'] = 'l', ['L'] = 'l', ['m'] = 'm',
    ['M'] = 'm',   ['n'] = 'n',   ['N'] = 'n',   ['o'] = 'o', ['O'] = 'o', ['p'] = 'p',
    ['P'] = 'p',   ['q'] = 'q',   ['Q'] = 'q',   ['r'] = 'r', ['R'] = 'r', ['s'] = 's',
    ['S'] = 's',   ['t'] = 't',   ['T'] = 't',   ['u'] = 'u', ['U'] = 'u', ['v'] = 'v',
    ['V'] = 'v',   ['w'] = 'w',   ['W'] = 'w',   ['x'] = 'x', ['X'] = 'x', ['y'] = 'y',
    ['Y'] = 'y',   ['z'] = 'z',   ['Z'] = 'z',   [1] = 1,     [2] = 2,     [3] = 3,
    [4] = 4,       [5] = 5,       [6] = 6,       [7] = 7,     [8] = 8,     [9] = 9,
    [10] = 10,     [11] = 11,     [12] = 12,     [13] = 13,   [14] = 14,   [15] = 15,
    [16] = 16,     [17] = 17,     [18] = 18,     [19] = 19,   [20] = 20,   [21] = 21,
    [22] = 22,     [23] = 23,     [24] = 24,     [25] = 25,   [26] = 26,   [27] = 27,
    [28] = 28,     [29] = 29,     [30] = 30,     [31] = 31,   [127] = 127,
};

/** Look-up table for fast 'to_upper' method */
u8 static const CLM_STRING_UPPER_LUT[] = {
    [' '] = ' ',   ['!'] = '!',   ['\"'] = '\"', ['#'] = '#', ['$'] = '$', ['%'] = '%',
    ['&'] = '&',   ['\''] = '\'', ['*'] = '*',   ['+'] = '+', [','] = ',', ['-'] = '-',
    ['='] = '=',   ['`'] = '`',   ['^'] = '^',   ['~'] = '~', ['.'] = '.', ['/'] = '/',
    ['\\'] = '\\', ['|'] = '|',   [':'] = ':',   [';'] = ';', ['('] = '(', [')'] = ')',
    ['{'] = '{',   ['}'] = '}',   ['<'] = '<',   ['>'] = '>', ['['] = '[', [']'] = ']',
    ['_'] = '_',   ['0'] = '0',   ['1'] = '1',   ['2'] = '2', ['3'] = '3', ['4'] = '4',
    ['5'] = '5',   ['6'] = '6',   ['7'] = '7',   ['8'] = '8', ['9'] = '9', ['a'] = 'A',
    ['A'] = 'A',   ['b'] = 'B',   ['B'] = 'B',   ['c'] = 'C', ['C'] = 'C', ['d'] = 'D',
    ['D'] = 'D',   ['e'] = 'E',   ['E'] = 'E',   ['f'] = 'F', ['F'] = 'F', ['g'] = 'G',
    ['G'] = 'G',   ['h'] = 'H',   ['H'] = 'H',   ['i'] = 'I', ['I'] = 'I', ['j'] = 'J',
    ['J'] = 'J',   ['k'] = 'K',   ['K'] = 'K',   ['l'] = 'L', ['L'] = 'L', ['m'] = 'M',
    ['M'] = 'M',   ['n'] = 'N',   ['N'] = 'N',   ['o'] = 'O', ['O'] = 'O', ['p'] = 'P',
    ['P'] = 'P',   ['q'] = 'Q',   ['Q'] = 'Q',   ['r'] = 'R', ['R'] = 'R', ['s'] = 'S',
    ['S'] = 'S',   ['t'] = 'T',   ['T'] = 'T',   ['u'] = 'U', ['U'] = 'U', ['v'] = 'V',
    ['V'] = 'V',   ['w'] = 'W',   ['W'] = 'W',   ['x'] = 'X', ['X'] = 'X', ['y'] = 'Y',
    ['Y'] = 'Y',   ['z'] = 'Z',   ['Z'] = 'Z',   [1] = 1,     [2] = 2,     [3] = 3,
    [4] = 4,       [5] = 5,       [6] = 6,       [7] = 7,     [8] = 8,     [9] = 9,
    [10] = 10,     [11] = 11,     [12] = 12,     [13] = 13,   [14] = 14,   [15] = 15,
    [16] = 16,     [17] = 17,     [18] = 18,     [19] = 19,   [20] = 20,   [21] = 21,
    [22] = 22,     [23] = 23,     [24] = 24,     [25] = 25,   [26] = 26,   [27] = 27,
    [28] = 28,     [29] = 29,     [30] = 30,     [31] = 31,   [127] = 127,
};

/*****************************************************************************************
 * STATICS AND CONSTANTS END
 ****************************************************************************************/

/*****************************************************************************************
 * IMPLEMENTATION BEGIN
 ****************************************************************************************/

clm_string *clm_string_new(void)
{
    clm_string *str = NULL;

    str = malloc(sizeof *str);
    if (!str) {
        fprintf(stderr, "clm_string_new: failed to alloc xstring\n");
        exit(EXIT_FAILURE);
    }

    return (str);
}

clm_string *clm_string_from(u8 const *buf, usize len)
{
    clm_string *str = NULL;
    usize length    = len;

    if (buf && len == 0) {
        u8 const *cpy = buf;
        while (*cpy++) {
            length += 1;
        }

        assert(length > 0);
    }

    if (!buf) {
        fprintf(stderr, "clm_string_from: buf is null\n");
        exit(EXIT_FAILURE);
    }

    str = malloc(sizeof *str);

    return (str);
}

/*****************************************************************************************
 * IMPLEMENTATION END
 ****************************************************************************************/
